<view class="page-container">
  <view class="nav-wrapper" style="height: 91px; overflow: hidden; background: #fff;">
    <navigation-bar title="é±¼ç¼¸è¯¦æƒ…" back="{{true}}" color="black" background="#fff"></navigation-bar>
  </view>

  <!-- åŠ è½½çŠ¶æ€ - éª¨æ¶å± -->
  <view class="skeleton-loading" wx:if="{{loading}}">
    <!-- å°é¢éª¨æ¶å± -->
    <view class="skeleton-hero"></view>

    <!-- åŸºç¡€ä¿¡æ¯å¡ç‰‡éª¨æ¶å± -->
    <view class="section">
      <view class="card">
        <view class="skeleton-row" wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="skeleton-label"></view>
          <view class="skeleton-value"></view>
        </view>
        <view class="skeleton-btn"></view>
      </view>
    </view>

    <!-- æ­»äº¡æ¡£æ¡ˆéª¨æ¶å± -->
    <view class="section">
      <view class="skeleton-header"></view>
      <view class="skeleton-list-item" wx:for="{{[1,2]}}" wx:key="*this">
        <view class="skeleton-icon"></view>
        <view class="skeleton-content">
          <view class="skeleton-line short"></view>
          <view class="skeleton-line medium"></view>
        </view>
      </view>
    </view>
  </view>

  <scroll-view class="page-scroll" scroll-y enhanced show-scrollbar="{{false}}" wx:if="{{tank && !loading}}">
    <!-- å°é¢å›¾ - ç‚¹å‡»å¯æ›´æ¢ -->
    <view class="hero-image-wrapper" bindtap="onChangeCover">
       <image wx:if="{{tank.coverUrl}}" src="{{tank.coverUrl}}" mode="aspectFill" class="hero-image"></image>
       <view wx:else class="hero-placeholder">ğŸ </view>
       <view class="hero-overlay">
          <text class="hero-title">{{tank.name}}</text>
       </view>
       <view class="hero-edit-hint">
          <image class="hero-edit-icon" src="/assets/icons/camera.svg" mode="aspectFit" />
          <text>ç‚¹å‡»æ›´æ¢å°é¢</text>
       </view>
    </view>

    <!-- åŸºç¡€ä¿¡æ¯ -->
    <view class="section">
       <view class="card">
          <view class="card-row">
             <text class="label">å°ºå¯¸</text>
             <text class="value" wx:if="{{tank.size}}">{{tank.size.length}}x{{tank.size.width}}x{{tank.size.height}} cm</text>
             <text class="value" wx:else>æœªè®¾ç½®</text>
          </view>
          <view class="card-row">
             <text class="label">è´­ä¹°ä»·æ ¼</text>
             <text class="value">Â¥{{tank.price || 0}}</text>
          </view>
          <view class="card-row">
             <text class="label">æ€»æŠ•å…¥</text>
             <text class="value font-bold">Â¥{{stats.totalInvestment || 0}}</text>
          </view>

          <view class="action-row">
             <button class="btn btn--outline btn--sm" bindtap="onEditTank">ç¼–è¾‘ä¿¡æ¯</button>
          </view>
       </view>
    </view>

    <!-- æ­»äº¡æ¡£æ¡ˆ -->
    <view class="section">
       <view class="section-header">
          <text class="section-title">æ­»äº¡æ¡£æ¡ˆ</text>
          <text class="text-muted text-sm">å…± {{stats.fish.deadCount || 0}} æ¡</text>
       </view>

       <view class="death-list" wx:if="{{deathList.length > 0}}">
          <view class="death-item" wx:for="{{deathList}}" wx:key="_id">
             <view class="death-icon">ğŸª¦</view>
             <view class="death-info">
                <text class="death-name">{{item.customName}}</text>
                <text class="death-date">è´­å…¥: {{item.purchaseDate}}</text>
             </view>
             <view class="death-stat">
                <text class="death-count">-{{item.quantity}}</text>
                <text class="death-price">Â¥{{item.purchasePrice * item.quantity}}</text>
             </view>
          </view>
       </view>
       <view class="empty-state" wx:else>
          <text class="text-muted">æš‚æ— æ­»äº¡è®°å½•ï¼Œç»§ç»­ä¿æŒï¼</text>
       </view>
    </view>

    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- ç¼–è¾‘å¼¹çª— - ä½¿ç”¨ page-container ç»„ä»¶ -->
  <page-container
    show="{{showEditPopup}}"
    round
    position="bottom"
    custom-style="background-color: #fff;"
    bind:afterleave="onCloseEditPopup"
  >
    <view class="popup-content">
      <!-- å¤´éƒ¨ -->
      <view class="popup__header">
        <text class="popup__close" bindtap="onCloseEditPopup">Ã—</text>
        <text class="popup__title">ç¼–è¾‘é±¼ç¼¸</text>
        <view class="popup__placeholder"></view>
      </view>

      <!-- è¡¨å•å†…å®¹ -->
      <scroll-view class="popup__body" scroll-y enhanced show-scrollbar="{{false}}">
        <view class="form-wrapper">
          <!-- é±¼ç¼¸åç§° -->
          <view class="form-item">
            <text class="form-label">é±¼ç¼¸åç§° <text class="required">*</text></text>
            <input class="input" placeholder="è¯·è¾“å…¥åç§°ï¼ˆ20å­—ä»¥å†…ï¼‰" maxlength="20" value="{{editForm.name}}" data-field="name" bindinput="onEditFormInput"></input>
          </view>

          <!-- è´­ä¹°ä»·æ ¼ -->
          <view class="form-item">
            <text class="form-label">è´­ä¹°ä»·æ ¼ (Â¥)</text>
            <input class="input" type="digit" placeholder="0.00" value="{{editForm.price}}" data-field="price" bindinput="onEditFormInput"></input>
          </view>

          <!-- é±¼ç¼¸å°ºå¯¸ - åªè¯»å±•ç¤º -->
          <view class="form-item">
            <text class="form-label">é±¼ç¼¸å°ºå¯¸</text>
            <view class="size-display">
              <text class="size-display__label">{{sizeDisplay.label}}</text>
              <text class="size-display__desc" wx:if="{{sizeDisplay.desc}}">{{sizeDisplay.desc}}</text>
            </view>
            <text class="form-hint">å°ºå¯¸åœ¨åˆ›å»ºæ—¶ç¡®å®šï¼Œä¸å¯ä¿®æ”¹</text>
          </view>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="popup__footer">
        <button class="btn btn--outline" bindtap="onDeleteTank" disabled="{{saving}}">åˆ é™¤é±¼ç¼¸</button>
        <button class="btn btn--primary" bindtap="onSaveEdit" loading="{{saving}}" disabled="{{saving}}">ä¿å­˜</button>
      </view>
    </view>
  </page-container>
</view>
